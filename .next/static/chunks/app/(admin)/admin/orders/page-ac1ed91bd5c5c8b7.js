(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[841],{3235:function(e,t,s){Promise.resolve().then(s.bind(s,9634))},9634:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return AdminOrdersPage}});var r=s(7437),l=s(2265),a=s(1396),d=s.n(a),i=s(4421),n=s(9175);function AdminOrdersPage(){let[e,t]=(0,l.useState)([]),[s,a]=(0,l.useState)(!0),[c,o]=(0,l.useState)(""),[x,h]=(0,l.useState)("all"),m=(0,i.e)(),p=(0,l.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s="admin:orders";if(!e){let e=n.V.get(s);if(e){console.log("Using cached orders data"),t(e),a(!1);return}}try{let{data:e,error:r}=await m.from("orders").select("id, order_number, total_amount, status, payment_status, shipping_address, created_at, updated_at").order("created_at",{ascending:!1});if(r)throw r;let l=e||[];if(0===l.length){t([]),n.V.set(s,[],3e4);return}let a=l.map(e=>e.id),{data:d,error:i}=await m.from("order_items").select("id, order_id, product_name, product_price, quantity, size").in("order_id",a);if(i)throw i;let c={};(d||[]).forEach(e=>{let t=c[e.order_id]||[];t.push({id:e.id,product_name:e.product_name,price:e.product_price,quantity:e.quantity,size:e.size}),c[e.order_id]=t});let o=l.map(e=>({...e,order_items:c[e.id]||[]}));t(o),n.V.set(s,o,3e4)}catch(e){try{console.error("Failed to fetch orders:",JSON.stringify(e))}catch(t){console.error("Failed to fetch orders:",e)}o("Failed to load orders")}finally{a(!1)}},[m]);(0,l.useEffect)(()=>{p()},[p]);let updateOrderStatus=async(e,s)=>{try{let{error:r}=await m.rpc("update_order_status",{p_order_id:e,p_status:s,p_notes:"Status updated by admin"});if(r)throw r;n.V.delete("admin:orders"),t(t=>t.map(t=>t.id===e?{...t,status:s}:t))}catch(e){console.error("Failed to update order status:",e),alert("Failed to update order status")}},deleteOrder=async e=>{try{let s=window.confirm("Delete this order? This cannot be undone.");if(!s)return;let{error:r}=await m.from("orders").delete().eq("id",e);if(r)throw r;n.V.delete("admin:orders"),t(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Failed to delete order:",e),alert("Failed to delete order")}},getStatusColor=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"shipped":return"bg-purple-100 text-purple-800";case"delivered":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},u="all"===x?e:e.filter(e=>e.status===x);return s?(0,r.jsx)("div",{className:"min-h-screen bg-slate-900",children:(0,r.jsx)("div",{className:"px-4 sm:px-6 lg:px-8 py-8",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[(0,r.jsx)("div",{className:"h-8 bg-white/20 rounded mb-8"}),(0,r.jsx)("div",{className:"h-64 bg-white/20 rounded"})]})})}):(0,r.jsx)("div",{className:"min-h-screen bg-slate-900",children:(0,r.jsxs)("div",{className:"px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsxs)("div",{className:"mb-6 lg:mb-8",children:[(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6 lg:mb-8",children:[(0,r.jsxs)("div",{className:"mb-4 lg:mb-0",children:[(0,r.jsx)("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-black text-white mb-2 lg:mb-4 tracking-tight",children:"Order Management"}),(0,r.jsx)("p",{className:"text-white/70 text-sm sm:text-base lg:text-lg",children:"Manage and track all customer orders"})]}),(0,r.jsx)("div",{className:"text-left lg:text-right",children:(0,r.jsxs)("div",{className:"text-xs sm:text-sm font-medium text-white",children:[u.length," Total Orders"]})})]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2 sm:gap-3 mb-6 lg:mb-8",children:[(0,r.jsxs)("button",{onClick:()=>h("all"),className:"px-3 sm:px-6 py-2 sm:py-3 rounded-xl sm:rounded-2xl font-semibold transition-all duration-300 text-xs sm:text-sm ".concat("all"===x?"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/25":"bg-white/10 text-white hover:bg-white/20 backdrop-blur-sm"),children:["All (",e.length,")"]}),(0,r.jsxs)("button",{onClick:()=>h("pending"),className:"px-3 sm:px-6 py-2 sm:py-3 rounded-xl sm:rounded-2xl font-semibold transition-all duration-300 text-xs sm:text-sm ".concat("pending"===x?"bg-gradient-to-r from-yellow-500 to-yellow-600 text-white shadow-lg shadow-yellow-500/25":"bg-white/10 text-white hover:bg-white/20 backdrop-blur-sm"),children:["Pending (",e.filter(e=>"pending"===e.status).length,")"]}),(0,r.jsxs)("button",{onClick:()=>h("processing"),className:"px-3 sm:px-6 py-2 sm:py-3 rounded-xl sm:rounded-2xl font-semibold transition-all duration-300 text-xs sm:text-sm ".concat("processing"===x?"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/25":"bg-white/10 text-white hover:bg-white/20 backdrop-blur-sm"),children:["Processing (",e.filter(e=>"processing"===e.status).length,")"]}),(0,r.jsxs)("button",{onClick:()=>h("shipped"),className:"px-3 sm:px-6 py-2 sm:py-3 rounded-xl sm:rounded-2xl font-semibold transition-all duration-300 text-xs sm:text-sm ".concat("shipped"===x?"bg-gradient-to-r from-purple-500 to-purple-600 text-white shadow-lg shadow-purple-500/25":"bg-white/10 text-white hover:bg-white/20 backdrop-blur-sm"),children:["Shipped (",e.filter(e=>"shipped"===e.status).length,")"]}),(0,r.jsxs)("button",{onClick:()=>h("delivered"),className:"px-3 sm:px-6 py-2 sm:py-3 rounded-xl sm:rounded-2xl font-semibold transition-all duration-300 text-xs sm:text-sm ".concat("delivered"===x?"bg-gradient-to-r from-green-500 to-green-600 text-white shadow-lg shadow-green-500/25":"bg-white/10 text-white hover:bg-white/20 backdrop-blur-sm"),children:["Delivered (",e.filter(e=>"delivered"===e.status).length,")"]})]})]}),c&&(0,r.jsx)("div",{className:"bg-red-500/20 border border-red-500 text-red-200 p-4 rounded-lg mb-6",children:c}),(0,r.jsx)("div",{className:"hidden md:block bg-white/10 backdrop-blur-sm border border-white/20 rounded-2xl overflow-hidden shadow-xl",children:(0,r.jsxs)("div",{className:"overflow-x-auto",children:[(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{className:"bg-white/5",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs sm:text-sm font-black text-white uppercase tracking-wider",children:"Order"}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs sm:text-sm font-black text-white uppercase tracking-wider",children:"Customer"}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs sm:text-sm font-black text-white uppercase tracking-wider",children:"Items"}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs sm:text-sm font-black text-white uppercase tracking-wider",children:"Total"}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs sm:text-sm font-black text-white uppercase tracking-wider",children:"Status"}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs sm:text-sm font-black text-white uppercase tracking-wider",children:"Date"}),(0,r.jsx)("th",{className:"px-6 py-4 text-left text-xs sm:text-sm font-black text-white uppercase tracking-wider",children:"Actions"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-white/10",children:u.map(e=>{var t,s;return(0,r.jsxs)("tr",{className:"hover:bg-white/5 align-top",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm sm:text-base font-black text-white",children:e.order_number}),(0,r.jsx)("div",{className:"text-xs text-gray-300",children:new Date(e.created_at).toLocaleDateString()})]})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-semibold text-white",children:(null===(t=e.shipping_address)||void 0===t?void 0:t.name)||"Guest"}),(0,r.jsx)("div",{className:"text-xs text-gray-300",children:(null===(s=e.shipping_address)||void 0===s?void 0:s.email)||"No email"})]})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsxs)("div",{className:"text-sm text-white",children:[e.order_items.length," item(s)"]})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsxs)("div",{className:"text-sm font-black text-blue-300",children:["â‚±",e.total_amount.toLocaleString()]})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(getStatusColor(e.status)),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("div",{className:"text-sm text-gray-300",children:new Date(e.created_at).toLocaleDateString()})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)(d(),{href:"/order/".concat(e.id),className:"text-blue-400 hover:text-blue-300 font-semibold",children:"View"}),(0,r.jsxs)("select",{value:e.status,onChange:t=>updateOrderStatus(e.id,t.target.value),className:"bg-white/10 text-white border border-white/20 rounded px-2 py-1 text-xs",children:[(0,r.jsx)("option",{value:"pending",children:"Pending"}),(0,r.jsx)("option",{value:"processing",children:"Processing"}),(0,r.jsx)("option",{value:"shipped",children:"Shipped"}),(0,r.jsx)("option",{value:"delivered",children:"Delivered"}),(0,r.jsx)("option",{value:"cancelled",children:"Cancelled"})]}),(0,r.jsx)("button",{onClick:()=>deleteOrder(e.id),className:"text-red-400 hover:text-red-300 font-semibold",children:"Delete"})]})})]},e.id)})})]}),0===u.length&&(0,r.jsx)("div",{className:"text-center py-12",children:(0,r.jsx)("p",{className:"text-gray-300 text-lg",children:"all"===x?"No orders found":"No ".concat(x," orders found")})})]})}),(0,r.jsx)("div",{className:"md:hidden space-y-4",children:u.map(e=>{var t,s;return(0,r.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm border border-white/20 rounded-2xl p-4 shadow-xl",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-base font-black text-white",children:e.order_number}),(0,r.jsx)("div",{className:"text-xs text-gray-300",children:new Date(e.created_at).toLocaleDateString()})]}),(0,r.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(getStatusColor(e.status)),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]}),(0,r.jsx)("div",{className:"text-sm text-white mb-1",children:(null===(t=e.shipping_address)||void 0===t?void 0:t.name)||"Guest"}),(0,r.jsx)("div",{className:"text-xs text-gray-300 mb-3",children:(null===(s=e.shipping_address)||void 0===s?void 0:s.email)||"No email"}),(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"text-xs text-gray-300",children:[e.order_items.length," item(s)"]}),(0,r.jsxs)("div",{className:"text-base font-black text-blue-300",children:["â‚±",e.total_amount.toLocaleString()]})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)(d(),{href:"/order/".concat(e.id),className:"flex-1 text-center bg-white/10 text-white border border-white/20 rounded px-3 py-2 text-sm font-semibold",children:"View"}),(0,r.jsx)("button",{onClick:()=>deleteOrder(e.id),className:"px-3 py-2 text-sm font-semibold text-red-300 border border-red-400/40 rounded",children:"Delete"})]}),(0,r.jsxs)("select",{value:e.status,onChange:t=>updateOrderStatus(e.id,t.target.value),className:"bg-white/10 text-white border border-white/20 rounded px-3 py-2 text-sm",children:[(0,r.jsx)("option",{value:"pending",children:"Pending"}),(0,r.jsx)("option",{value:"processing",children:"Processing"}),(0,r.jsx)("option",{value:"shipped",children:"Shipped"}),(0,r.jsx)("option",{value:"delivered",children:"Delivered"}),(0,r.jsx)("option",{value:"cancelled",children:"Cancelled"})]})]})]},e.id)})})]})})}},9175:function(e,t,s){"use strict";s.d(t,{V:function(){return r}});let AdminCache=class AdminCache{set(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4;this.cache.set(e,{data:t,timestamp:Date.now(),ttl:s})}get(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>t.ttl?(this.cache.delete(e),null):t.data:null}delete(e){this.cache.delete(e)}clear(){this.cache.clear()}clearAdmin(){for(let e of this.cache.keys())e.startsWith("admin:")&&this.cache.delete(e)}constructor(){this.cache=new Map}};let r=new AdminCache},4421:function(e,t,s){"use strict";s.d(t,{e:function(){return createClient}});var r=s(359),l=s(2601);let a=l.env.NEXT_PUBLIC_SUPABASE_URL,d=l.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,createClient=()=>(0,r.eI)(a,d)}},function(e){e.O(0,[673,396,971,472,744],function(){return e(e.s=3235)}),_N_E=e.O()}]);