(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[578],{4976:function(e,t,s){Promise.resolve().then(s.bind(s,2694))},2694:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return AdminProducts}});var l=s(7437),r=s(2265),a=s(1396),d=s.n(a),n=s(4033),i=s(4421),c=s(9080),o=s(9175),x=s(8574);function AdminProducts(){let{user:e,loading:t}=(0,c.a)(),s=(0,n.useRouter)(),[a,m]=(0,r.useState)([]),[u,h]=(0,r.useState)(!0),[p,g]=(0,r.useState)(""),[b,f]=(0,r.useState)(null),j=(0,r.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!e){console.log("No user authenticated");return}let s="admin:products:".concat(e.id);if(!t){let e=o.V.get(s);if(e){console.log("Using cached products data"),m(e),h(!1);return}}try{let t=(0,i.e)();console.log("Fetching products for user:",e.id);let{data:l,error:r}=await t.from("products").select("*").order("created_at",{ascending:!1});if(r){console.error("Error fetching products:",r),g("Failed to fetch products: "+r.message);return}console.log("Products fetched:",l);let a=await Promise.all(l.map(async e=>{let{data:s,error:l}=await t.from("product_variants").select("size, stock").eq("product_id",e.id);return l&&console.error("Error fetching variants for product",e.id,":",l),{...e,variants:s||[]}}));m(a),o.V.set(s,a,3e4)}catch(e){console.error("Fetch products error:",e),g("Failed to fetch products: "+e.message)}finally{h(!1)}},[e]);(0,r.useEffect)(()=>{t||e?e&&j():s.push("/login")},[e,t,s,j]);let handleDelete=async t=>{if(!e){g("You must be logged in to delete products");return}if(confirm("Are you sure you want to delete this product? This action cannot be undone.")){f(t),g("");try{let s=(0,i.e)();console.log("Deleting product:",t,"for user:",e.id);let{error:l}=await s.from("product_variants").delete().eq("product_id",t);if(l){console.error("Error deleting variants:",l),g("Failed to delete product variants");return}let{error:r}=await s.from("products").delete().eq("id",t);if(r){console.error("Error deleting product:",r),g("Failed to delete product: "+r.message);return}console.log("Product deleted successfully");let a="admin:products:".concat(e.id);o.V.delete(a),await j(!0)}catch(e){console.error("Delete error:",e),g("Failed to delete product: "+e.message)}finally{f(null)}}},getStatusColor=e=>{switch(e){case"active":return"bg-green-100 text-green-800 border-green-200";case"inactive":return"bg-red-100 text-red-800 border-red-200";case"draft":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},getTotalStock=e=>e.reduce((e,t)=>e+t.stock,0),getStockColor=e=>0===e?"text-red-600 font-semibold":e<10?"text-yellow-600 font-semibold":"text-green-600 font-semibold";return t||u?(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"flex justify-between items-center mb-8",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-slate-900 to-slate-700 bg-clip-text text-transparent mb-2",children:"Manage Products"}),(0,l.jsx)("p",{className:"text-slate-600",children:t?"Checking authentication...":"Loading products..."})]})}),(0,l.jsx)("div",{className:"bg-white p-6 rounded-2xl shadow-lg border border-white/50",children:(0,l.jsx)("div",{className:"animate-pulse space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,l.jsx)("div",{className:"h-16 bg-slate-200 rounded"},t))})})]}):e?(0,l.jsx)("div",{className:"min-h-screen bg-slate-900",children:(0,l.jsxs)("div",{className:"px-4 sm:px-6 lg:px-8 py-8",children:[(0,l.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-8",children:[(0,l.jsxs)("div",{className:"mb-6 lg:mb-0",children:[(0,l.jsx)("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-black text-white mb-2 lg:mb-4 tracking-tight",children:"Product Management"}),(0,l.jsx)("p",{className:"text-white/70 text-sm sm:text-base lg:text-lg",children:"Add, edit, and manage your product catalog"})]}),(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[(0,l.jsxs)("button",{onClick:async()=>{if(!e){g("You must be logged in to create products");return}try{let t=(0,i.e)();console.log("Creating test product for user:",e.id);let{data:s,error:l}=await t.from("products").insert([{name:"Test Product "+Date.now(),slug:"test-product-"+Date.now(),description:"A test product for testing delete functionality",price:99.99,brand:"Test",status:"active"}]).select().single();if(l)console.error("Error creating test product:",l),g("Failed to create test product: "+l.message);else{console.log("Test product created:",s);let t="admin:products:".concat(e.id);o.V.delete(t),await j(!0)}}catch(e){console.error("Create test product error:",e),g("Failed to create test product: "+e.message)}},className:"bg-gradient-to-r from-green-600 to-blue-600 text-white px-3 sm:px-4 py-2 sm:py-3 rounded-xl text-xs sm:text-sm font-semibold hover:from-green-700 hover:to-blue-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center",children:[(0,l.jsx)("span",{className:"mr-2",children:"\uD83E\uDDEA"}),"Create Test Product"]}),(0,l.jsxs)(d(),{href:"/admin/products/new",className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-3 sm:px-6 py-2 sm:py-3 rounded-xl text-xs sm:text-sm font-semibold hover:from-blue-700 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center justify-center",children:[(0,l.jsx)("span",{className:"mr-2",children:"âž•"}),"New Product"]})]})]}),p&&(0,l.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:(0,l.jsx)("p",{className:"text-red-600 text-sm",children:p})}),(0,l.jsx)("div",{className:"bg-white p-3 sm:p-6 rounded-2xl shadow-lg border border-white/50",children:u?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"hidden lg:block",children:(0,l.jsx)(x.hM,{})}),(0,l.jsxs)("div",{className:"lg:hidden space-y-4",children:[(0,l.jsx)(x.ZF,{}),(0,l.jsx)(x.ZF,{}),(0,l.jsx)(x.ZF,{})]})]}):0===a.length?(0,l.jsxs)("div",{className:"text-center py-8 sm:py-12 px-4 sm:px-6",children:[(0,l.jsx)("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-xl sm:text-2xl mx-auto mb-4",children:"\uD83D\uDCE6"}),(0,l.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-slate-900 mb-2",children:"No products found"}),(0,l.jsx)("p",{className:"text-sm sm:text-base text-slate-600 mb-6",children:"Get started by creating your first product"}),(0,l.jsx)(d(),{href:"/admin/products/new",className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-xl text-xs sm:text-sm font-semibold hover:from-blue-700 hover:to-purple-700 transition-all duration-200",children:"Create Product"})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"hidden lg:block overflow-x-auto",children:(0,l.jsxs)("table",{className:"min-w-full",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"border-b border-slate-200",children:[(0,l.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Product"}),(0,l.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Brand"}),(0,l.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Price"}),(0,l.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Stock"}),(0,l.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Status"}),(0,l.jsx)("th",{className:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider",children:"Actions"})]})}),(0,l.jsx)("tbody",{className:"divide-y divide-slate-100",children:a.map(e=>{var t;let s=getTotalStock(e.variants);return(0,l.jsxs)("tr",{className:"hover:bg-slate-50 transition-colors",children:[(0,l.jsx)("td",{className:"px-6 py-4",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold text-sm mr-4",children:(null===(t=e.name.split(" ")[1])||void 0===t?void 0:t.charAt(0))||"S"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-sm font-semibold text-slate-900",children:e.name}),(0,l.jsxs)("div",{className:"text-xs text-slate-500",children:["Slug: ",e.slug]})]})]})}),(0,l.jsx)("td",{className:"px-6 py-4",children:(0,l.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e.brand})}),(0,l.jsx)("td",{className:"px-6 py-4",children:(0,l.jsxs)("span",{className:"text-lg font-bold text-slate-900",children:["$",e.price.toFixed(2)]})}),(0,l.jsxs)("td",{className:"px-6 py-4",children:[(0,l.jsxs)("span",{className:"text-sm font-semibold ".concat(getStockColor(s)),children:[s," units"]}),(0,l.jsxs)("div",{className:"text-xs text-slate-500",children:[e.variants.length," variant",1!==e.variants.length?"s":""]})]}),(0,l.jsx)("td",{className:"px-6 py-4",children:(0,l.jsx)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold border ".concat(getStatusColor(e.status)),children:e.status})}),(0,l.jsx)("td",{className:"px-6 py-4",children:(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)(d(),{href:"/admin/products/edit/".concat(e.id),className:"text-blue-600 hover:text-blue-800 text-sm font-medium px-3 py-1 rounded-lg hover:bg-blue-50 transition-colors",children:"Edit"}),(0,l.jsx)("button",{onClick:()=>handleDelete(e.id),disabled:b===e.id,className:"text-red-600 hover:text-red-800 text-sm font-medium px-3 py-1 rounded-lg hover:bg-red-50 transition-colors disabled:opacity-50",children:b===e.id?"Deleting...":"Delete"})]})})]},e.id)})})]})}),(0,l.jsx)("div",{className:"lg:hidden",children:a.map(e=>{var t;let s=getTotalStock(e.variants);return(0,l.jsxs)("div",{className:"border-b border-slate-200 last:border-b-0 p-4",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,l.jsxs)("div",{className:"flex items-center flex-1",children:[(0,l.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold text-sm mr-3",children:(null===(t=e.name.split(" ")[1])||void 0===t?void 0:t.charAt(0))||"S"}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("div",{className:"text-sm font-semibold text-slate-900 truncate",children:e.name}),(0,l.jsxs)("div",{className:"text-xs text-slate-500 truncate",children:["Slug: ",e.slug]})]})]}),(0,l.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat("active"===e.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.status})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs text-slate-500 uppercase tracking-wider",children:"Brand"}),(0,l.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e.brand})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"text-xs text-slate-500 uppercase tracking-wider",children:"Price"}),(0,l.jsxs)("div",{className:"text-sm font-semibold text-slate-900",children:["$",e.price.toFixed(2)]})]})]}),(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsx)("div",{className:"text-xs text-slate-500 uppercase tracking-wider mb-1",children:"Stock"}),(0,l.jsxs)("div",{className:"text-sm font-semibold ".concat(getStockColor(s)),children:[s," units"]}),(0,l.jsxs)("div",{className:"text-xs text-slate-500",children:[e.variants.length," variant",1!==e.variants.length?"s":""]})]}),(0,l.jsxs)("div",{className:"flex space-x-3",children:[(0,l.jsx)(d(),{href:"/admin/products/edit/".concat(e.id),className:"flex-1 bg-blue-600 text-white px-3 py-2 rounded-lg text-xs font-medium text-center hover:bg-blue-700 transition-colors",children:"Edit"}),(0,l.jsx)("button",{onClick:()=>handleDelete(e.id),disabled:b===e.id,className:"flex-1 bg-red-600 text-white px-3 py-2 rounded-lg text-xs font-medium hover:bg-red-700 transition-colors disabled:opacity-50",children:b===e.id?"Deleting...":"Delete"})]})]},e.id)})})]})})]})}):(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"flex justify-between items-center mb-8",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-slate-900 to-slate-700 bg-clip-text text-transparent mb-2",children:"Access Denied"}),(0,l.jsx)("p",{className:"text-slate-600",children:"You must be logged in to access this page"})]})}),(0,l.jsxs)("div",{className:"bg-white p-6 rounded-2xl shadow-lg border border-white/50 text-center",children:[(0,l.jsx)("p",{className:"text-slate-600 mb-4",children:"Please log in to manage products"}),(0,l.jsx)(d(),{href:"/login",className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl text-sm font-semibold hover:from-blue-700 hover:to-purple-700 transition-all duration-200",children:"Go to Login"})]})]})}},8574:function(e,t,s){"use strict";s.d(t,{ZF:function(){return MobileCardSkeleton},hM:function(){return TableSkeleton},q4:function(){return CardSkeleton}});var l=s(7437);s(2265);let Skeleton=e=>{let{className:t="",children:s}=e;return(0,l.jsx)("div",{className:"animate-pulse bg-gray-200 rounded ".concat(t),children:s})},CardSkeleton=()=>(0,l.jsxs)("div",{className:"bg-white p-4 sm:p-6 lg:p-8 rounded-3xl border border-gray-200 shadow-xl",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,l.jsx)(Skeleton,{className:"w-12 h-12 sm:w-16 sm:h-16 rounded-2xl"}),(0,l.jsx)(Skeleton,{className:"w-16 h-6 rounded-full"})]}),(0,l.jsx)(Skeleton,{className:"w-24 h-4 mb-2"}),(0,l.jsx)(Skeleton,{className:"w-20 h-8 mb-2"}),(0,l.jsx)(Skeleton,{className:"w-32 h-3"})]}),TableSkeleton=()=>(0,l.jsx)("div",{className:"bg-white p-3 sm:p-6 rounded-2xl shadow-lg border border-white/50",children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex space-x-4",children:[(0,l.jsx)(Skeleton,{className:"w-24 h-4"}),(0,l.jsx)(Skeleton,{className:"w-20 h-4"}),(0,l.jsx)(Skeleton,{className:"w-16 h-4"}),(0,l.jsx)(Skeleton,{className:"w-20 h-4"}),(0,l.jsx)(Skeleton,{className:"w-18 h-4"}),(0,l.jsx)(Skeleton,{className:"w-16 h-4"})]}),[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center space-x-4 py-4 border-b border-gray-100",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)(Skeleton,{className:"w-10 h-10 rounded-lg"}),(0,l.jsxs)("div",{children:[(0,l.jsx)(Skeleton,{className:"w-24 h-4 mb-1"}),(0,l.jsx)(Skeleton,{className:"w-16 h-3"})]})]}),(0,l.jsx)(Skeleton,{className:"w-16 h-6 rounded-full"}),(0,l.jsx)(Skeleton,{className:"w-12 h-4"}),(0,l.jsx)(Skeleton,{className:"w-16 h-4"}),(0,l.jsx)(Skeleton,{className:"w-16 h-6 rounded-full"}),(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)(Skeleton,{className:"w-12 h-8 rounded"}),(0,l.jsx)(Skeleton,{className:"w-12 h-8 rounded"})]})]},t))]})}),MobileCardSkeleton=()=>(0,l.jsxs)("div",{className:"bg-white p-4 rounded-2xl shadow-lg border border-white/50",children:[(0,l.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,l.jsxs)("div",{className:"flex items-center flex-1",children:[(0,l.jsx)(Skeleton,{className:"w-10 h-10 rounded-lg mr-3"}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)(Skeleton,{className:"w-24 h-4 mb-1"}),(0,l.jsx)(Skeleton,{className:"w-16 h-3"})]})]}),(0,l.jsx)(Skeleton,{className:"w-16 h-6 rounded-full"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(Skeleton,{className:"w-12 h-3 mb-1"}),(0,l.jsx)(Skeleton,{className:"w-16 h-6 rounded-full"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(Skeleton,{className:"w-12 h-3 mb-1"}),(0,l.jsx)(Skeleton,{className:"w-12 h-4"})]})]}),(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsx)(Skeleton,{className:"w-12 h-3 mb-1"}),(0,l.jsx)(Skeleton,{className:"w-16 h-4 mb-1"}),(0,l.jsx)(Skeleton,{className:"w-20 h-3"})]}),(0,l.jsxs)("div",{className:"flex space-x-3",children:[(0,l.jsx)(Skeleton,{className:"flex-1 h-8 rounded-lg"}),(0,l.jsx)(Skeleton,{className:"flex-1 h-8 rounded-lg"})]})]})},9080:function(e,t,s){"use strict";s.d(t,{a:function(){return useAuth}}),s(7437);var l=s(2265);s(4421);let r=(0,l.createContext)(void 0);function useAuth(){let e=(0,l.useContext)(r);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9175:function(e,t,s){"use strict";s.d(t,{V:function(){return l}});let AdminCache=class AdminCache{set(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4;this.cache.set(e,{data:t,timestamp:Date.now(),ttl:s})}get(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>t.ttl?(this.cache.delete(e),null):t.data:null}delete(e){this.cache.delete(e)}clear(){this.cache.clear()}clearAdmin(){for(let e of this.cache.keys())e.startsWith("admin:")&&this.cache.delete(e)}constructor(){this.cache=new Map}};let l=new AdminCache},4421:function(e,t,s){"use strict";s.d(t,{e:function(){return createClient}});var l=s(359),r=s(2601);let a=r.env.NEXT_PUBLIC_SUPABASE_URL,d=r.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,createClient=()=>(0,l.eI)(a,d)},4033:function(e,t,s){e.exports=s(94)}},function(e){e.O(0,[673,396,971,472,744],function(){return e(e.s=4976)}),_N_E=e.O()}]);